description = "Analyze AWS cloud architecture and create a cloud optimization plan"
prompt = """
First, activate the 'pba-workspace-tools' skill to ensure you have the correct tool mappings for this environment.

Using the pba-cloud-developer skill, prepare a cloud architecture review report. You must analyze AWS cloud patterns, scalability, and cost optimization opportunities in the codebase and create a comprehensive plan WITHOUT making any changes.

## Tool Configuration

**IMPORTANT**: Consult the pba-workspace-tools skill for your organization's configured tools.
Use ONLY the tools listed in the Active Configuration section of pba-workspace-tools.
If a capability is not configured, inform the user and continue with available capabilities.

## Input Parsing
The user invoked: /pba-cloud-review {{args}}

Valid scopes:
- **No argument**: Analyze the entire project
- **File/directory path**: Scope analysis to that specific path
- **"current changes"**: Analyze uncommitted changes (use source_control `status` and `diff_uncommitted` capabilities)
- **"recent changes"**: Analyze recent commits (use source_control `log` capability)
- **Change request reference**: Analyze a specific PR/CL (use change_requests `view` and `diff` capabilities)

### Scope Resolution
Consult pba-workspace-tools for source_control and change_requests capabilities:

1. If scope is "current changes":
   - Use the `status` capability to identify changed files
   - Use the `diff_uncommitted` capability to see uncommitted changes
   - Focus analysis on modified code only

2. If scope is "recent changes":
   - Use the `log` capability to see recent commits
   - Analyze changes from recent development

3. If scope matches the change_requests `reference_format`:
   - Extract the change request ID from the scope
   - Use change_requests `view` capability to get details
   - Use change_requests `diff` capability to get the changes
   - Focus on files changed in the change request

4. If scope is a path:
   - Verify the path exists
   - Scope analysis to that path

5. If no scope provided:
   - Analyze the entire project

## Your Task
1. First, understand the codebase and identify cloud architecture patterns
2. Analyze AWS service usage and optimization opportunities
3. Create a prioritized cloud improvement plan
4. Save your plan as a markdown file in the /reports directory

## Analysis Steps
1. **Cloud Architecture Review**
   - Identify AWS services in use
   - Check for anti-patterns
   - Assess scalability design
   - Review fault tolerance
   - Analyze security configurations
   - Evaluate cost optimization

2. **AWS Best Practices Assessment**
   - Well-Architected Framework compliance
   - Service selection appropriateness
   - Resource tagging strategy
   - Monitoring and alerting setup
   - Backup and disaster recovery
   - Network architecture

3. **Cost and Performance Analysis**
   - Instance sizing optimization
   - Reserved capacity opportunities
   - Unused resource identification
   - Data transfer costs
   - Storage optimization
   - Serverless opportunities

## Output Format
Create a markdown file at `/reports/cloud-review-{timestamp}.md` with:

```markdown
# Cloud Architecture Review Plan
Generated: {timestamp}
Scope: {full_path_or_entire_project}

## Executive Summary
Brief overview of cloud architecture state and critical findings

## AWS Architecture Findings
### Critical Issues (Production Impact)
- [ ] Single point of failure: Component X
- [ ] Missing auto-scaling: Service Y
- [ ] Security group misconfiguration: Resource Z

### High Priority Issues
- [ ] Cost optimization: Over-provisioned resources
- [ ] Missing monitoring: Critical service A
- [ ] Backup strategy: Database B

### Medium Priority Issues
- [ ] Tagging inconsistency: Resources C
- [ ] Suboptimal service choice: Function D

## Current Architecture Assessment
### Services in Use
- EC2: X instances
- RDS: Y databases
- S3: Z buckets
- Lambda: N functions
- Other: List

### Architecture Patterns
- Deployment model: Monolithic/Microservices/Serverless
- Scaling strategy: Current approach
- Availability zones: Coverage
- Disaster recovery: RTO/RPO

## Cloud Optimization Plan
### Immediate Actions (1-3 days)
1. Fix security group rules
2. Enable CloudWatch monitoring
3. Implement backup strategy

### Short-term Improvements (1-2 weeks)
1. Implement auto-scaling for service X
2. Migrate to managed services for Y
3. Optimize instance types

### Long-term Transformations (2-8 weeks)
1. Implement multi-AZ deployment
2. Adopt serverless for appropriate workloads
3. Implement infrastructure as code

## Cost Optimization Opportunities
### Quick Wins
- Right-size EC2 instances: Save $X/month
- Delete unused resources: Save $Y/month
- Enable S3 lifecycle policies: Save $Z/month

### Strategic Changes
- Move to reserved instances: Save X%
- Implement spot instances: Save Y%
- Optimize data transfer: Save $Z/month

## Security Improvements
### Critical
- Enable encryption at rest
- Implement least privilege IAM
- Enable VPC flow logs

### Important
- Implement AWS WAF
- Enable GuardDuty
- Set up Security Hub

## Scalability Enhancements
### Auto-scaling Setup
- Services requiring auto-scaling
- Scaling policies to implement
- Load balancer configuration

### Performance Optimization
- CDN implementation
- Caching strategy
- Database read replicas

## Disaster Recovery Plan
### Backup Strategy
- RDS automated backups
- S3 cross-region replication
- EBS snapshot automation

### Recovery Procedures
- RTO target: X minutes
- RPO target: Y minutes
- Failover process

## Compliance and Governance
### Well-Architected Review
- Operational Excellence: Score
- Security: Score
- Reliability: Score
- Performance: Score
- Cost Optimization: Score

### Recommendations
- Governance improvements
- Compliance requirements
- Audit trail setup

## Migration Roadmap
### Phase 1: Foundation (Week 1-2)
- Security hardening
- Monitoring setup
- Backup implementation

### Phase 2: Optimization (Week 3-4)
- Cost optimization
- Performance tuning
- Auto-scaling setup

### Phase 3: Transformation (Week 5-8)
- Serverless migration
- Multi-region setup
- Advanced features

## Estimated Impact
- Cost reduction: X%
- Performance improvement: Y%
- Availability increase: Z%

## Risk Assessment
- Migration risks: List
- Mitigation strategies: Details
- Rollback procedures: Plan
```

Remember: DO NOT make any changes. Only analyze and report.
---

## CRITICAL: Report Generation

**YOU MUST CREATE THE REPORT FILE.** This is not optional.

### Final Steps (MANDATORY)

1. **Create the report file** using the Write tool at the specified path:
   - Path format: `/reports/{command-name}-{scope}-{timestamp}.md`
   - Use ISO timestamp format: `YYYY-MM-DD-HHmmss`
   - Example: `/reports/architecture-review-entire-project-2025-10-14-143022.md`

2. **Fill in ALL sections** of the report template
   - Do not leave placeholder text
   - Provide specific, actionable findings
   - Include file paths and line numbers where relevant

3. **Confirm completion** by telling the user:
   - "Report saved to: [full path]"
   - Brief summary of key findings
   - Next steps or how to use the report

### Common Mistakes to Avoid

❌ **DON'T**: Just summarize findings in the chat
❌ **DON'T**: Say "I'll create a report" without actually doing it
❌ **DON'T**: Leave sections incomplete or with placeholders
❌ **DON'T**: Forget to use the Write tool

✅ **DO**: Always use the Write tool to create the markdown file
✅ **DO**: Fill in every section with real findings
✅ **DO**: Provide the full path to the user when done
✅ **DO**: Include actionable recommendations

### Verification Checklist

Before responding to the user, verify:
- [ ] Report file created with Write tool
- [ ] All template sections filled in
- [ ] Specific findings with file references
- [ ] Actionable recommendations included
- [ ] Timestamp in filename
- [ ] Full path provided to user

**Remember**: The report is the primary deliverable. The chat summary is secondary.
"""
