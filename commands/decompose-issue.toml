description = "Break down a large issue into smaller, manageable sub-issues with appropriate linkages and dependencies."
prompt = """
# decompose-issue

Break down a large issue into smaller, manageable sub-issues with appropriate linkages and dependencies.

## Tool Configuration

**IMPORTANT**: Consult the workspace-tools skill for your organization's configured tools.
Use ONLY the tools listed in the Active Configuration section of workspace-tools.
If a capability is not configured, inform the user and continue with available capabilities.

## Usage
```
/decompose-issue {issue_number_or_file}
```

## Examples
- `/decompose-issue 4` - Decompose issue #4 (format depends on workspace-tools config)
- `/decompose-issue issues/4.md` - Decompose local issue file

The issue reference format is defined in workspace-tools (`issue_tracking.reference_format`).
Examples: `#4` (GitHub), `b/4` (Internal), `PROJECT-4` (Jira)

## Description
This command analyzes a complex issue and intelligently breaks it down into smaller, atomic tasks that can each be implemented in a single change request. It maintains traceability through issue linking and dependency tracking.

## Workflow

### 1. Issue Retrieval
Consult workspace-tools for issue_tracking capabilities:
- Use the configured `availability_check` to verify access (if defined)
- Use the configured `fetch_issue` tool with the issue ID
- **If issue_tracking not configured**: Read from `/issues/{number}.md`
- Parse YAML frontmatter for metadata

### 2. Issue Analysis
- Analyze scope and complexity
- Identify logical boundaries for decomposition
- Extract success criteria and requirements

### 3. Decomposition Strategy
The command uses several strategies to identify sub-tasks:
- **Functional decomposition**: Separate by feature/functionality
- **Technical layers**: Split by architectural layers (frontend/backend/database)
- **Dependency chains**: Identify what must be done first
- **Testing boundaries**: Separate implementation from testing
- **Documentation needs**: Split docs into separate tasks

### 4. Sub-Issue Creation
For each identified sub-task:
- Create descriptive title prefixed with parent issue reference
- Include context from parent issue
- Define clear scope and success criteria
- Assign appropriate specialist agent
- Set priority based on dependencies
- Add labels inherited from parent plus specific ones

Consult workspace-tools for issue_tracking capabilities:
- Use the configured `create_issue` tool for each sub-task
- **If create_issue not configured**: Create `/issues/{number}.md` with YAML frontmatter

### 5. Linking and Dependencies
- Add "Part of {parent_reference}" in each sub-issue (use `reference_format` from workspace-tools)
- Create dependency comments showing order
- Update parent issue with checklist of sub-issues
- Add "has-subtasks" label/tag to parent if supported
- Create milestone if appropriate

**If issue_tracking not configured:**
- Update parent file's frontmatter with `has_subtasks: true`
- Update parent file's body with sub-issue checklist

## Local Issue File Format

When working with local files, sub-issues include a `parent` field in frontmatter:

```markdown
---
number: 12
title: "Implement user model and database schema"
parent: 4
labels:
  - database
  - phase-1
priority: High
agent: database-designer
dependencies: []
status: open
---

## Overview
This is part of {parent_reference}: {parent_title}

## Scope
{specific_scope_for_this_subtask}

## Requirements
- {requirement_1}
- {requirement_2}

## Success Criteria
- [ ] {criterion_1}
- [ ] {criterion_2}

## Recommended Specialist
database-designer skill
```

The parent issue is updated with:

```markdown
---
number: 4
title: "Implement user authentication system"
has_subtasks: true
subtasks: [12, 13, 14, 15, 16, 17, 18, 19]
status: open
---

## Decomposition

This issue has been broken down into the following sub-tasks:

### Implementation Tasks
- [ ] {ref}12: Implement user model and database schema - database-designer skill
- [ ] {ref}13: Create authentication service layer - architect skill
...
```

## Decomposition Patterns

### Large Feature Implementation
```
Parent: Implement user authentication system
Sub-issues:
├── {ref}12: Implement user model and database schema
├── {ref}13: Create authentication service layer
├── {ref}14: Build login/logout API endpoints
├── {ref}15: Add session management
├── {ref}16: Implement password reset flow
├── {ref}17: Add authentication middleware
├── {ref}18: Create authentication UI components
└── {ref}19: Write authentication tests
```

### Complex Refactoring
```
Parent: Refactor monolithic service into microservices
Sub-issues:
├── {ref}20: Extract user service
├── {ref}21: Extract payment service
├── {ref}22: Extract notification service
├── {ref}23: Implement service communication
├── {ref}24: Update deployment configuration
└── {ref}25: Migrate existing data
```

### Performance Optimization
```
Parent: Optimize application performance
Sub-issues:
├── {ref}26: Profile and identify bottlenecks
├── {ref}27: Optimize database queries
├── {ref}28: Implement caching layer
├── {ref}29: Add lazy loading
├── {ref}30: Optimize bundle size
└── {ref}31: Add performance monitoring
```

## Sub-Issue Template

```markdown
## Overview
This is part of {parent_reference}: {parent_title}

## Scope
{specific_scope_for_this_subtask}

## Requirements
- {requirement_1}
- {requirement_2}

## Success Criteria
- [ ] {criterion_1}
- [ ] {criterion_2}

## Dependencies
- Depends on: {other_issue_reference} (if applicable)
- Blocks: {blocked_issue_reference} (if applicable)

## Recommended Specialist
{specialist_name} skill

## Parent Issue Context
{relevant_context_from_parent}

## Notes
- Estimated effort: {estimate}
- Priority: {High/Medium/Low}
```

## Parent Issue Update

After decomposition, the parent issue is updated with:

```markdown
## Decomposition

This issue has been broken down into the following sub-tasks:

### Implementation Tasks
- [ ] {ref}12: {title} - skill-name
- [ ] {ref}13: {title} - skill-name
- [ ] {ref}14: {title} - skill-name

### Testing Tasks
- [ ] {ref}15: {title} - test-automator skill

### Documentation Tasks
- [ ] {ref}16: {title} - code-documentor skill

### Dependencies
```mermaid
graph TD
    A[{ref}12] --> B[{ref}13]
    B --> C[{ref}14]
    C --> D[{ref}15]
    C --> E[{ref}16]
```

**Note**: This issue is now tracked through its sub-issues. It will be closed automatically when all sub-issues are completed.
```

## Intelligent Decomposition Rules

1. **Size Limits**: Each sub-issue should be completable in 1-2 days
2. **Single Responsibility**: Each sub-issue has one clear objective
3. **Independent Testing**: Each can be tested in isolation
4. **Clear Dependencies**: Explicit ordering when required
5. **Specialist Alignment**: Each maps to appropriate agent expertise

## Agent Assignment Logic

| Sub-task Type | Assigned Specialist |
|--------------|-------------------|
| API endpoints | architect skill |
| Database changes | configuration-manager skill |
| UI components | accessibility-specialist skill |
| Testing | test-automator skill |
| Documentation | code-documentor skill |
| Performance | performance-optimizer skill |
| Security | security-master skill |
| Refactoring | refactorer skill |
| Bug fixes | debugger skill |
| Build/Deploy | build-master skill |

## Options

- `--max-size {n}`: Maximum number of sub-issues to create
- `--auto-assign`: Automatically assign agents based on analysis
- `--create-milestone`: Create milestone for all sub-issues
- `--priority {high|medium|low}`: Set priority for all sub-issues

## Example Output

```
Analyzing issue {ref}4: Refactor sync script into modular functions
✓ Issue complexity: High (estimated 5-8 days)
✓ Identified 6 logical sub-tasks
✓ Creating sub-issues...

Created sub-issues:
├── {ref}32: Extract file comparison functions (assigned: refactorer skill)
├── {ref}33: Create validation module (assigned: test-automator skill)
├── {ref}34: Implement error handling module (assigned: exception-handling-master skill)
├── {ref}35: Create logging functions (assigned: logging-master skill)
├── {ref}36: Write unit tests for modules (assigned: test-automator skill)
└── {ref}37: Update documentation (assigned: code-documentor skill)

✓ Updated parent issue {ref}4 with sub-task checklist
✓ Added dependency relationships
✓ Created milestone: "Sync Script Refactoring"
```

## Benefits

- **Manageable Change Requests**: Each sub-issue results in a focused CR/PR
- **Parallel Work**: Independent sub-tasks can be worked on simultaneously
- **Clear Progress**: Checklist in parent shows overall progress
- **Better Estimates**: Smaller tasks are easier to estimate
- **Specialist Optimization**: Each task goes to the right expert
- **Reduced Complexity**: Breaking down makes large tasks approachable

## Notes
- Use this when an issue would result in 200+ lines of changes
- Particularly useful for architectural changes
- Helps maintain clean version control history with atomic commits
- Enables better code review with smaller change requests
"""
