description = "Comprehensive code evolution analysis through version history, change requests, and collaborative development patterns"
prompt = """
Using the code-historian skill, analyze the code history and evolution patterns. You must create a comprehensive, detailed historical analysis report WITHOUT making any changes.

## Tool Configuration

**IMPORTANT**: Consult the workspace-tools skill for your organization's configured tools.
Use ONLY the tools listed in the Active Configuration section of workspace-tools.
If source_control is not configured, inform the user that code history analysis requires source control tools.

## Input Parsing
The user invoked: /code-history-detailed {{args}}

Valid scopes:
- **No argument**: Analyze the entire project's history
- **File/directory path**: Track evolution of specific file or directory
- **"file.js author:name"**: Focus on specific author's changes to a file
- **"last 30 days"**: Analyze recent history within timeframe
- **Change request reference**: Analyze history related to a specific PR/CL (format from workspace-tools)
- **"hotspots"**: Identify most frequently changed files
- **"co-changes"**: Find files that change together

### Scope Resolution
Consult workspace-tools for source_control capabilities:

1. If scope is a file or directory path:
   - Use the `log_file` capability to track changes
   - Use the `blame` capability for line-level authorship
   - Identify all commits affecting this path

2. If scope includes "author:":
   - Extract author name
   - Use the `log` capability with author filter
   - Focus on that author's contributions

3. If scope includes time period:
   - Parse timeframe (e.g., "last 30 days", "since 2024-01-01")
   - Use the `log` capability with date filter
   - Analyze recent evolution patterns

4. If scope is a change request reference:
   - Check workspace-tools for the `change_requests.reference_format`
   - Use change_requests `view` capability to get details
   - Use change_requests `diff` capability to see changes
   - Use source_control `log` to find related commits

5. If scope is "hotspots":
   - Use the `log` capability to count changes per file
   - Identify top 20 most frequently modified files
   - Analyze change frequency and patterns

6. If scope is "co-changes":
   - Analyze commits to find files frequently changed together
   - Use the `log` capability to group files by commit
   - Calculate co-change frequency matrix

7. If no scope provided:
   - Analyze overall project history
   - Identify key contributors, hotspots, and patterns

## Your Task
1. Gather history data using the configured source_control and change_requests tools
2. Analyze patterns in code evolution
3. Identify collaboration patterns and frequently co-changed files
4. Create a comprehensive historical analysis report
5. Save your report as a markdown file in the /reports directory

## Analysis Steps
1. **Data Collection**
   - Extract commit history with authors, dates, and messages
   - Gather change request data if change_requests is configured
   - Identify file modification patterns
   - Track authorship and contributions

2. **Timeline Construction**
   - Build chronological view of changes
   - Identify major refactoring events
   - Track feature development through commits
   - Note significant architectural changes

3. **Authorship Analysis**
   - Identify primary contributors by file/module
   - Track contributor activity over time
   - Identify code ownership patterns
   - Analyze collaboration between authors

4. **Co-change Pattern Detection**
   - Find files that change together
   - Identify module coupling through change patterns
   - Detect architectural boundaries from change clusters
   - Find tightly coupled components

5. **Hotspot Identification**
   - Rank files by change frequency
   - Identify unstable/frequently modified code
   - Correlate hotspots with bug fixes
   - Flag potential technical debt areas

6. **Change Request Pattern Analysis** (if change_requests configured)
   - Analyze change request size and scope patterns
   - Track feature development cycles
   - Identify review patterns
   - Correlate change requests with commit history

## Output Format
Create a markdown file at `/reports/code-history-{scope}-{timestamp}.md` with:

```markdown
# Code History Analysis
Generated: {timestamp}
Scope: {scope_description}
Analysis Period: {date_range}

## Executive Summary
Brief overview of code evolution patterns and key findings

## Timeline
### Major Events
- YYYY-MM-DD: {significant change description} (commit: abc123)
- YYYY-MM-DD: {feature introduction} ({cr_reference})
- YYYY-MM-DD: {refactoring event} (commit: def789)

### Evolution Visualization
```
{ASCII timeline or text-based visualization}
```

## Authorship Analysis
### Top Contributors
| Author | Commits | Files Changed | Lines Added | Lines Removed |
|--------|---------|---------------|-------------|---------------|
| Alice  | 150     | 45            | 5000        | 2000          |
| Bob    | 120     | 38            | 4500        | 1800          |

### Code Ownership
- **Module A**: Primarily Alice (60%), Bob (30%)
- **Module B**: Primarily Bob (70%), Charlie (20%)

### Collaboration Patterns
- Alice and Bob frequently collaborate on auth module
- Charlie works independently on UI components

## Change Frequency Analysis
### Hotspots (Top 20)
| File | Changes | Authors | First Modified | Last Modified |
|------|---------|---------|----------------|---------------|
| src/auth.js | 45 | 3 | 2023-01-15 | 2024-12-01 |

### Interpretation
- High churn files indicate:
  - Unstable requirements
  - Technical debt areas
  - Complex business logic

## Co-change Patterns
### Files That Change Together
| File Pair | Co-change Count | Coupling Strength |
|-----------|-----------------|-------------------|
| auth.js + user.js | 23 | High |
| api.js + routes.js | 18 | Medium |

### Change Clusters
- **Cluster 1**: Authentication system (auth.js, user.js, session.js)
- **Cluster 2**: API layer (api.js, routes.js, middleware.js)

### Architectural Insights
- Co-change patterns reveal module boundaries
- High coupling between X and Y suggests refactoring opportunity

## Change Request Analysis
(If change_requests configured in workspace-tools)

### Statistics
- Total Change Requests: X
- Average size: Y files changed
- Average review time: Z hours

### Notable Change Requests
- **{cr_reference}** (2024-06-15): Major refactoring of auth system
  - Files: 15 changed
  - Impact: Touched multiple modules

### Patterns
- Feature changes typically involve 5-8 files
- Bug fixes usually touch 1-3 files
- Refactorings can affect 10+ files

## Commit Patterns
### Commit Message Analysis
- X% follow conventional commits
- Common prefixes: feat, fix, refactor, docs
- Quality varies by author

### Commit Size
- Average files per commit: X
- Median lines changed: Y
- Large commits (>500 lines): Z

## Historical Insights
### Code Stability
- Stable modules (few changes): {list}
- Unstable modules (many changes): {list}

### Development Velocity
- Commits per week trend: {description}
- Active development periods: {list}

### Technical Debt Indicators
- Files with >20 commits: {list}
- Frequent bug fixes in: {list}
- Refactoring candidates: {list}

## Key Findings
1. {Finding with supporting data}
2. {Finding with supporting data}
3. {Finding with supporting data}

## Appendix
### Tools Used
Based on workspace-tools configuration:
- Source control: {source_control.type}
- Change requests: {change_requests.type if configured}

### Data Sources
- Commits: X analyzed
- Change requests: Y analyzed (if applicable)
- Date range: {start} to {end}
```

## Missing Capabilities
If source_control is not configured in workspace-tools:
- Inform the user that code history analysis requires source control tools
- Suggest they configure source_control in their workspace-tools skill

Remember: DO NOT make any changes. Only analyze and report. Focus on building insights from historical data to inform future development decisions.
"""
