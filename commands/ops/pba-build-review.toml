description = "Analyze build systems and CI/CD pipelines to identify optimization opportunities"
prompt = """
First, activate the 'pba-workspace-tools' skill to ensure you have the correct tool mappings for this environment.

Using the pba-build-master skill, prepare a comprehensive build and CI/CD review report. You must analyze build performance, dependency management, pipeline efficiency, and deployment processes WITHOUT making any changes.

## Tool Configuration

**IMPORTANT**: Consult the pba-workspace-tools skill for your organization's configured tools.
Use ONLY the tools listed in the Active Configuration section of pba-workspace-tools.
If a capability is not configured, inform the user and continue with available capabilities.

## Input Parsing
The user invoked: /build-review {{args}}

Valid scopes:
- **No argument**: Analyze the entire project's build system
- **File/directory path**: Scope analysis to that specific path
- **"current changes"**: Analyze uncommitted changes (use source_control `status` and `diff_uncommitted` capabilities)
- **"recent changes"**: Analyze recent commits (use source_control `log` capability)
- **Change request reference**: Analyze a specific PR/CL (use change_requests `view` and `diff` capabilities)

### Scope Resolution
Consult pba-workspace-tools for source_control and change_requests capabilities:

1. If scope is "current changes":
   - Use the `status` capability to identify changed files
   - Use the `diff_uncommitted` capability to see uncommitted changes
   - Focus analysis on build-related changes only

2. If scope is "recent changes":
   - Use the `log` capability to see recent commits
   - Analyze build system changes from recent development

3. If scope matches the change_requests `reference_format`:
   - Extract the change request ID from the scope
   - Use change_requests `view` capability to get details
   - Use change_requests `diff` capability to get the changes
   - Focus on build files changed in the change request

4. If scope is a path:
   - Verify the path exists
   - Scope analysis to that path

5. If no scope provided:
   - Analyze the entire project's build system

## Your Task
1. First, understand the build system architecture and CI/CD setup
2. Analyze build performance, efficiency, and optimization opportunities
3. Create a prioritized build improvement plan
4. Save your plan as a markdown file in the /reports directory

## Analysis Steps
1. **Build System Assessment**
   - Identify build tools (webpack, rollup, vite, gradle, maven, etc.)
   - Analyze build configuration files
   - Check dependency management practices
   - Review build scripts and automation
   - Assess build artifact generation
   - Evaluate build caching strategies

2. **CI/CD Pipeline Review**
   - Examine CI configuration files (.github/workflows, .gitlab-ci.yml, etc.)
   - Review pipeline stages and job dependencies
   - Analyze parallel execution opportunities
   - Check deployment automation
   - Evaluate environment management
   - Review rollback strategies

3. **Performance Analysis**
   - Build time measurement and bottlenecks
   - Bundle size optimization opportunities
   - Dependency analysis and tree shaking
   - Cache effectiveness
   - Resource utilization during builds
   - Pipeline execution time

4. **Best Practices Review**
   - Multi-stage build implementations
   - Environment-specific configurations
   - Secrets and environment variable management
   - Test integration within pipelines
   - Artifact storage and versioning
   - Monitoring and alerting setup

## Output Format
Create a markdown file at `/reports/build-review-{timestamp}.md` with:

```markdown
# Build System Review Plan
Generated: {timestamp}
Scope: {full_path_or_entire_project}

## Executive Summary
Brief overview of build system health, performance metrics, and critical optimization opportunities

## Build System Findings
### Critical Issues
- [ ] Performance blocker: Description and impact
- [ ] Pipeline failure risk: Description and location

### High Priority Optimizations
- [ ] Build time improvement: Details and potential savings
- [ ] Dependency issue: Details and resolution

### Medium Priority Issues
- [ ] Caching optimization: Details
- [ ] Configuration improvement: Details

### Low Priority Enhancements
- [ ] Minor optimization: Details

## Current State Analysis
### Build Tools and Configuration
- Primary build tool: {tool_name}
- Build time: {current_time}
- Bundle size: {current_size}
- Cache hit ratio: {percentage}

### CI/CD Pipeline Status
- Pipeline execution time: {duration}
- Success rate: {percentage}
- Parallel job utilization: {assessment}
- Deployment frequency: {frequency}

### Dependencies
- Total dependencies: {count}
- Outdated packages: {count}
- Security vulnerabilities: {count}
- Bundle impact analysis: {findings}

## Build Performance Metrics
- Cold build time: {duration}
- Incremental build time: {duration}
- Test execution time: {duration}
- Pipeline total time: {duration}
- Cache effectiveness: {percentage}

## Improvement Plan
### Immediate Actions (Critical)
1. Fix pipeline stability issue X
2. Implement build caching for Y

### Short-term (1-2 weeks)
1. Optimize bundle splitting
2. Parallel test execution
3. Update build tool configuration

### Long-term Improvements (1+ months)
1. Migrate to faster build tool
2. Implement advanced caching strategies
3. Set up build monitoring and alerts

## CI/CD Pipeline Optimization
### Current Pipeline Analysis
- Stages: {list_of_stages}
- Bottlenecks: {identified_issues}
- Parallelization opportunities: {details}

### Recommended Improvements
- Pipeline restructuring: {recommendations}
- Job optimization: {specific_changes}
- Environment management: {improvements}

## Dependency Management
### Current State
- Package manager: {npm/yarn/pnpm/etc}
- Lock file status: {analysis}
- Update strategy: {current_approach}

### Recommendations
- Dependency updates: {strategy}
- Bundle optimization: {techniques}
- Security patches: {priority_list}

## Build Artifact Analysis
### Current Artifacts
- Bundle sizes: {breakdown}
- Compression: {current_state}
- Caching headers: {analysis}

### Optimization Opportunities
- Size reduction: {potential_savings}
- Format improvements: {recommendations}
- Distribution optimization: {suggestions}

## Recommendations
### Tool and Technology Updates
- Build tool migration: {if_applicable}
- CI/CD platform optimization: {suggestions}
- Monitoring tools: {recommendations}

### Process Improvements
- Build workflow optimization: {changes}
- Developer experience: {enhancements}
- Documentation updates: {needs}

### Performance Targets
- Build time target: {goal}
- Bundle size target: {goal}
- Pipeline execution target: {goal}
- Success rate target: {goal}

## Risk Assessment
- Current build reliability: Critical/High/Medium/Low
- Deployment risk level: {assessment}
- Post-optimization targets: {goals}
```

Remember: DO NOT make any changes to build files or CI/CD configurations. Only analyze and report optimization opportunities.
---

## CRITICAL: Report Generation

**YOU MUST CREATE THE REPORT FILE.** This is not optional.

### Final Steps (MANDATORY)

1. **Create the report file** using the Write tool at the specified path:
   - Path format: `/reports/{command-name}-{scope}-{timestamp}.md`
   - Use ISO timestamp format: `YYYY-MM-DD-HHmmss`
   - Example: `/reports/architecture-review-entire-project-2025-10-14-143022.md`

2. **Fill in ALL sections** of the report template
   - Do not leave placeholder text
   - Provide specific, actionable findings
   - Include file paths and line numbers where relevant

3. **Confirm completion** by telling the user:
   - "Report saved to: [full path]"
   - Brief summary of key findings
   - Next steps or how to use the report

### Common Mistakes to Avoid

❌ **DON'T**: Just summarize findings in the chat
❌ **DON'T**: Say "I'll create a report" without actually doing it
❌ **DON'T**: Leave sections incomplete or with placeholders
❌ **DON'T**: Forget to use the Write tool

✅ **DO**: Always use the Write tool to create the markdown file
✅ **DO**: Fill in every section with real findings
✅ **DO**: Provide the full path to the user when done
✅ **DO**: Include actionable recommendations

### Verification Checklist

Before responding to the user, verify:
- [ ] Report file created with Write tool
- [ ] All template sections filled in
- [ ] Specific findings with file references
- [ ] Actionable recommendations included
- [ ] Timestamp in filename
- [ ] Full path provided to user

**Remember**: The report is the primary deliverable. The chat summary is secondary.
"""
