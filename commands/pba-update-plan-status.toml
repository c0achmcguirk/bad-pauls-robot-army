description = "Check plan completion status by verifying issues, change requests, and actual implementation"
prompt = """
First, activate the 'pba-workspace-tools' skill to ensure you have the correct tool mappings for this environment.

Verify the completion status of a plan by checking associated issues, change requests, and validating that functionality has been implemented and tested.

## Tool Configuration

**IMPORTANT**: Consult the pba-workspace-tools skill for your organization's configured tools.
Use ONLY the tools listed in the Active Configuration section of pba-workspace-tools.
If capabilities are not configured, inform the user and use available alternatives.

## Input Parsing
The user invoked: /pba-update-plan-status {{args}}
- Path should point to a plan file (typically in /plans directory)
- If no path provided, list available plan files and ask user to specify

## Your Task
1. Read the specified plan file
2. Find all issues created from this plan
3. Check status of each issue and its associated change request
4. **Validate actual implementation** by examining the codebase
5. **Verify test coverage** for implemented features
6. Generate comprehensive status report
7. Update the plan file with completion status

## Workflow

### 1. Plan File Analysis
- Read plan to understand expected outcomes
- Extract all tasks/requirements
- Identify success criteria for each task

### 2. Issue Discovery
Consult pba-workspace-tools for issue_tracking capabilities:
- Use the configured `search_issues` tool to find issues referencing this plan
- For each issue: get number, title, state, labels, linked change request

**If issue_tracking not configured:**
- Search `/issues/*.md` for `source_plan: {plan_file_path}` in frontmatter
- Check status field, change request reference, completion timestamp

### 3. Change Request Verification
Consult pba-workspace-tools for change_requests capabilities:
- Use the configured `view` tool to check each linked change request
- Check if merged, closed without merge, or still open
- Check review status (approved/changes requested/pending)

**If change_requests not configured:**
- Skip this step and note in report

### 4. Implementation Validation (CRITICAL)
For each task:
1. **Identify what should exist** based on task description
2. **Search codebase** to verify implementation:
   - Use Grep to find relevant code
   - Use Glob to find expected files
   - Read key files to verify functionality
3. **Verify tests exist** for new functionality
4. **Validate integration** with existing systems

### 5. Status Categorization
- **‚úÖ Complete**: Issue closed, change request merged, functionality exists and is tested
- **‚ö†Ô∏è Partially Complete**: Change request merged but missing tests or incomplete
- **üöß In Progress**: Issue open or change request pending review
- **‚ùå Not Started**: No issue created or no work done
- **‚õî Blocked**: Blocked by dependencies or failing checks

### 6. Status Report Generation
Create report at `/reports/plan-status-{plan_name}-{timestamp}.md`:

```markdown
# Plan Status Report: {plan_file_name}
Generated: {timestamp}

## Overall Status
- Total Tasks: {count}
- ‚úÖ Complete: {count} ({percentage}%)
- ‚ö†Ô∏è Partially Complete: {count}
- üöß In Progress: {count}
- ‚ùå Not Started: {count}
- ‚õî Blocked: {count}

## Detailed Task Status

### ‚úÖ Complete
1. **{task_title}**
   - Issue: {issue_reference} (Closed)
   - Change Request: {cr_reference} (Merged)
   - Implementation: Verified at {file_path}
   - Tests: ‚úì {test_count} tests found

### ‚ö†Ô∏è Partially Complete
[Items with issues...]

### üöß In Progress
[Open work...]

### ‚ùå Not Started
[Missing items...]

## Recommendations
- High Priority Actions
- Quality Improvements Needed
- Next Steps

## Implementation Verification Details
- Missing Tests
- Incomplete Implementations
- Documentation Gaps
```

### 7. Update Plan File
Add status section to the plan file:
```markdown
## Implementation Status
Last updated: {timestamp}

### Completion Summary
- Overall: {percentage}% complete
- Tasks Complete: {count}/{total}

### Outstanding Items
- {item_1}
- {item_2}
```

## Success Criteria
A task is only **‚úÖ Complete** when ALL are true:
1. Issue is closed
2. Change request is merged
3. Expected functionality exists in codebase
4. Tests exist for new functionality
5. Tests are passing
6. Documentation is updated (if applicable)

This rigorous verification ensures "done" actually means "done and tested".

## Important Notes
- This command is **read-only** (doesn't modify issues/change requests)
- Provides objective assessment based on evidence
- Actual implementation check is critical - don't just rely on ticket status
- Missing tests = partial completion, not full completion
- Use `reference_format` from pba-workspace-tools when displaying issue/CR references
"""
